
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../images/favicon.svg">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.5">
    
    
      
        <title>Getting Started - nf-test</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cdeb8541.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="nf-test" class="md-header__button md-logo" aria-label="nf-test" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 2h-13C3.6 2 2 3.6 2 5.5v13C2 20.4 3.6 22 5.5 22H16l6-6V5.5C22 3.6 20.4 2 18.5 2M20 15h-1.5c-1.9 0-3.5 1.6-3.5 3.5V20H5.8c-1 0-1.8-.8-1.8-1.8V5.8C4 4.8 4.8 4 5.8 4h12.5c1 0 1.8.8 1.8 1.8V15m-4.9-6.8 1.5 1.5-6 6-3.5-3.5 1.5-1.5 2 2 4.5-4.5z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            nf-test
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/lukfor/nf-test/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="nf-test" class="md-nav__button md-logo" aria-label="nf-test" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 2h-13C3.6 2 2 3.6 2 5.5v13C2 20.4 3.6 22 5.5 22H16l6-6V5.5C22 3.6 20.4 2 18.5 2M20 15h-1.5c-1.9 0-3.5 1.6-3.5 3.5V20H5.8c-1 0-1.8-.8-1.8-1.8V5.8C4 4.8 4.8 4 5.8 4h12.5c1 0 1.8.8 1.8 1.8V15m-4.9-6.8 1.5 1.5-6 6-3.5-3.5 1.5-1.5 2 2 4.5-4.5z"/></svg>

    </a>
    nf-test
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lukfor/nf-test/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting Started
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#init" class="md-nav__link">
    Init
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-first-test" class="md-nav__link">
    Create your first test
  </a>
  
    <nav class="md-nav" aria-label="Create your first test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-when-block" class="md-nav__link">
    The when block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-then-block" class="md-nav__link">
    The then block
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#your-first-test-specification" class="md-nav__link">
    Your first test specification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-your-first-test" class="md-nav__link">
    Run your first test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    What's next?
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Testcases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Testcases" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Testcases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testcases/nextflow_process/" class="md-nav__link">
        nextflow_process
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testcases/nextflow_workflow/" class="md-nav__link">
        nextflow_workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testcases/nextflow_pipeline/" class="md-nav__link">
        nextflow_pipeline
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Command line interface (CLI)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Command line interface (CLI)" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Command line interface (CLI)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/init/" class="md-nav__link">
        init
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/generate/" class="md-nav__link">
        generate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/test/" class="md-nav__link">
        test
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../assertions/" class="md-nav__link">
        Assertions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#init" class="md-nav__link">
    Init
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-first-test" class="md-nav__link">
    Create your first test
  </a>
  
    <nav class="md-nav" aria-label="Create your first test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-when-block" class="md-nav__link">
    The when block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-then-block" class="md-nav__link">
    The then block
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#your-first-test-specification" class="md-nav__link">
    Your first test specification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-your-first-test" class="md-nav__link">
    Run your first test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    What's next?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/lukfor/nf-test/edit/master/docs/getting-started.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="getting-started">Getting started</h1>
<p>For this example we use the <a href="https://github.com/genepi/gwas-regenie"><code>gwas-regenie</code></a> pipeline. Open the terminal and clone the pipeline:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># clone nextflow pipeline</span>
git clone https://github.com/genepi/gwas-regenie

<span class="c1"># enter project directory</span>
<span class="nb">cd</span> gwas-regenie
</code></pre></div>
<p>We use the <a href=""><code>imputed_to_plink2.nf</code></a> process to create a testcase from scratch. This process takes a vcf file as input and converts it into the Plink2 format.</p>
<h2 id="init">Init</h2>
<p>Before we start creating our testcases, we use the <code>init</code> command to setup nf-test:</p>
<div class="highlight"><pre><span></span><code>$ nf-test init
</code></pre></div>
<p>The <code>init</code> command creates the following files in the root directory of the pipeline: <code>nf-test.config</code> and <code>tests/nextflow.config</code>. It also creates a folder <code>tests</code> which is the home of your testcode.</p>
<p>In the <a href="../configuration/">configuration</a> section you can learn more about this files.</p>
<h2 id="create-your-first-test">Create your first test</h2>
<p>The <code>generate</code> command helps you to create skeleton test code for a Nextflow process or the whole workflow.</p>
<p>Here we generate a testcase for the process <code>imputed_to_plink2.nf</code>:</p>
<div class="highlight"><pre><span></span><code>$ nf-test generate process modules/local/imputed_to_plink2.nf
</code></pre></div>
<p>This command creates a new file <code>tests/modules/local/imputed_to_plink2.nf.test</code> with the following content:</p>
<div class="highlight"><pre><span></span><code><span class="n">nextflow_process</span> <span class="o">{</span>

  <span class="n">name</span> <span class="s2">&quot;Test Process IMPUTED_TO_PLINK2&quot;</span>
  <span class="n">script</span> <span class="s2">&quot;modules/local/imputed_to_plink2.nf&quot;</span>
  <span class="n">process</span> <span class="s2">&quot;IMPUTED_TO_PLINK2&quot;</span>

    <span class="n">test</span><span class="o">(</span><span class="s2">&quot;Should run without failures&quot;</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">when</span> <span class="o">{</span>
            <span class="n">params</span> <span class="o">{</span>
                <span class="c1">// define parameters here. Example:</span>
                <span class="c1">// outdir = &quot;tests/results&quot;</span>
            <span class="o">}</span>
            <span class="n">process</span> <span class="o">{</span>
                <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                // define inputs of the process here. Example:</span>
<span class="s2">                // input[0] = file(&quot;test-file.txt&quot;)</span>
<span class="s2">                &quot;&quot;&quot;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">then</span> <span class="o">{</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">success</span>
            <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">with</span> <span class="o">{</span>
              <span class="c1">// Make assertions about the content and elements of output channels here. Example:</span>
              <span class="c1">// assert outdir != null</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<p>The <code>generate</code> command filled automatically the name, script and process of our testcase as well as created a skeleton for your first <code>test</code> method. Typically you create one file per process and use different <code>test</code> methods to describe the expected behaviour of the process.</p>
<p>A <code>test</code> has a name, a <code>when</code> and a <code>then</code> closure. The <code>when</code> block describes the input parameters of the workflow or the process. nf-test executes the process with exactly this parameters and parses the content of the output channels. Then, it evaluates the assertions defined in the <code>then</code> block to check if content of the output channels matches your expectations.</p>
<h3 id="the-when-block">The <code>when</code> block</h3>
<p>The <code>when</code> block describes the input of our process and/or the Nextflow <code>params</code>.</p>
<p>The <code>params</code> block is optional and is a simple map that can be used to override Nextflows input <code>params</code>.</p>
<p>The <code>process</code> block is a multiline string and you can use the <code>input</code> array to set the different inputs arguments of the process. In our example, we have only one input that expects a file. Let us update the <code>process</code> block by setting the first element of the <code>input</code> array to the path of a small VCF file:</p>
<div class="highlight"><pre><span></span><code><span class="n">when</span> <span class="o">{</span>
    <span class="n">params</span> <span class="o">{</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>
    <span class="o">}</span>
    <span class="n">process</span> <span class="o">{</span>
        <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        // Use example.vc.gz as first input for our process</span>
<span class="s2">        input[0] = file(&quot;tests/input/example.vcf.gz&quot;)</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>Everything that is defined in the process block is later executed in the Nextflow script that is created automatically to test your process. Therefore, you can use every Nextflow specific functions and commands to define the values of the input array (e.g. Channels, files, ...).</p>
<h3 id="the-then-block">The <code>then</code> block</h3>
<p>The <code>then</code> block describes the expected output channels of the process when we execute it with the input parameters from the <code>when</code> block.</p>
<p>The <code>then</code> block typically contains mainly assertions to check for example the size and the content of an output channel. However, this block accepts every Groovy script so you can import also third party libraries to define very specific assertions (e.g. a VCF-File Reader can be used to check number of variants).</p>
<p>nf-test automatically loads all output channels of the process and all their items into a map named <code>process.out</code>. You can then use this map to formulate your assertions.</p>
<p>For example, in the <code>imputed_to_plink2</code> process we expect to get an tuple that contains the filename, the pgen file, the psam file and the pvar file. Let us update the <code>then</code> section with some assertions that describe our expectations:</p>
<div class="highlight"><pre><span></span><code><span class="n">then</span> <span class="o">{</span>

    <span class="c1">// Checks if process runs without failures</span>
    <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">success</span>

    <span class="c1">//Checks if a chanell imputed_pink2 was created, has 1 element</span>
    <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span>
    <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="c1">//Checks if first tuple contains the expected content</span>
    <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">==</span> <span class="s2">&quot;example.vcf&quot;</span>
    <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">==~</span> <span class="s2">&quot;.*/example.vcf.pgen&quot;</span>  <span class="mi">1</span><span class="err">️⃣</span>
    <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">==~</span> <span class="s2">&quot;.*/example.vcf.psam&quot;</span>
    <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">==~</span> <span class="s2">&quot;.*/example.vcf.pvar&quot;</span>

    <span class="c1">//Checks if psam file contains 500 samples and 1 header line</span>
    <span class="kt">def</span> <span class="n">psam</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
    <span class="k">assert</span> <span class="n">file</span><span class="o">(</span><span class="n">psam</span><span class="o">).</span><span class="na">readLines</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">501</span>  <span class="mi">2</span><span class="err">️⃣</span>

<span class="o">}</span>
</code></pre></div>
<p><small>
1️⃣  we use a regular expression matching to check the filename, because the channels contains always the full path to an output file.</p>
<p>2️⃣  since we get the full path to a file, we can open it and compare the number of lines. We can also calculate a hash of the file and compare it with an expected one. See <a href="../assertions/">Assertions</a> for some examples and inspiration.
</small></p>
<p>The items of a channel are always sorted by nf-test. This provides a deterministic order inside the channel and enables you to write reproducible tests.</p>
<h2 id="your-first-test-specification">Your first test specification</h2>
<p>You can update the name of the test method to something that gives us later a good description of our specification. When we put everything together, we get the following full working test specification:</p>
<div class="highlight"><pre><span></span><code><span class="n">nextflow_process</span> <span class="o">{</span>

    <span class="n">name</span> <span class="s2">&quot;Test Process IMPUTED_TO_PLINK2&quot;</span>
    <span class="n">script</span> <span class="s2">&quot;modules/local/imputed_to_plink2.nf&quot;</span>
    <span class="n">process</span> <span class="s2">&quot;IMPUTED_TO_PLINK2&quot;</span>

    <span class="n">test</span><span class="o">(</span><span class="s2">&quot;Should create a pgen, psam and pvar file with 500 samples&quot;</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">when</span> <span class="o">{</span>
            <span class="n">process</span> <span class="o">{</span>
                <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                input[0] = file(&quot;tests/input/example.vcf.gz&quot;)</span>
<span class="s2">                &quot;&quot;&quot;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">then</span> <span class="o">{</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">success</span>

            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">==</span> <span class="s2">&quot;example.vcf&quot;</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">==~</span> <span class="s2">&quot;.*/example.vcf.pgen&quot;</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">==~</span> <span class="s2">&quot;.*/example.vcf.psam&quot;</span>
            <span class="k">assert</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">==~</span> <span class="s2">&quot;.*/example.vcf.pvar&quot;</span>

            <span class="kt">def</span> <span class="n">psam</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">imputed_plink2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
            <span class="k">assert</span> <span class="n">file</span><span class="o">(</span><span class="n">psam</span><span class="o">).</span><span class="na">readLines</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">501</span>
        <span class="o">}</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
<h2 id="run-your-first-test">Run your first test</h2>
<p>Now, the <code>test</code> command can be used to run your test:</p>
<div class="highlight"><pre><span></span><code>$ nf-test <span class="nb">test</span> tests/modules/local/imputed_to_plink2.nf.test --profile docker
</code></pre></div>
<p>In this case, the <code>docker</code> profile defined in the Nextflow pipeline is used to execute the test. The profile is set using the <code>--profile</code> parameter, but you can also define a default profile in the <a href="../configuration/">configuration file</a>.</p>
<p>Congratulation! You created you first nf-test specification.</p>
<h2 id="whats-next">What's next?</h2>
<ul>
<li>Learn how to write Assertions</li>
<li>Learn how to write workflow tests (integration test or e2e)</li>
<li>Learn how to config nf-test</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../installation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Installation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installation
            </div>
          </div>
        </a>
      
      
        
        <a href="../testcases/nextflow_process/" class="md-footer__link md-footer__link--next" aria-label="Next: nextflow_process" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              nextflow_process
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>